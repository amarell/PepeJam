<div id="page-wrapper">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12">
                <h1 class="page-header">UPLOAD</h1>
            </div>
            <!-- /.col-lg-12 -->
        </div>

        <div class="row">
            <div class="col-lg-6">
              <img id="upload-img" src="" alt="wait for upload">
              <form id="file-upload-form" role="form">
                <div class="form-group">
                    <label>File input</label>
                    <input id="input-form" name="file" type="file" multiple>
                </div>
                <button type="submit" class="btn btn-default" onclick="fileToBase64(document.getElementById('input-form'))">Upload</button>
              </form>
            </div>
        </div>

    </div>
    <!-- /.container-fluid -->
</div>
<!-- /#page-wrapper -->

<script type="text/javascript">
    function test() {
      console.dir(document.getElementById("input-form").files.length);
    }

    function fileToBase64(event) {
      if(event.files.length == 0){
        toastr.error("Choose a file to upload!");
        return 0;
      }
      console.log(event.files);
      var f = event.files[0];
      var reader = new FileReader();
      // Closure to capture the file information.
      reader.onload = (function(theFile) {
          return function(e) {
              // Render thumbnail.

              var upload = {
                 name: f.name,
                 content: e.target.result.split(',')[1]
              };
              $.ajax({
                  url: "http://localhost:8080/api/admin/cdn",
                  type: "POST",
                  data: JSON.stringify(upload),
                  contentType: "application/json",
                  beforeSend: function(xhr){xhr.setRequestHeader('Authentication', localStorage.getItem("token"));},
                  success: function(data) {
                    toastr.success("File uploaded successfully");
                    console.log(data);
                    $('#upload-img').attr('src',data.url);
                  },
                  error: function(jqXHR, textStatus, errorThrown ){
                    toastr.error(jqXHR.responseJSON.message);
                    console.log(jqXHR);
                  }
               });
          };
      })(f);
      // Read in the image file as a data URL.
      reader.readAsDataURL(f);
    }

</script>
